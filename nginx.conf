server {
    listen 80;
    server_tokens off; # Hide Nginx version

    # Set root for static files
    root /usr/share/nginx/html;

    # Serve index.html for all non-existent paths (SPA routing)
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Proxy API requests to the backend service
    # The API_BASE_URL environment variable will be set in Kubernetes Deployment
    location /api/ {
        # The backend API base URL, e.g., http://project-board-server-backend:5000
        # Nginx will append the path after /api/ to this base URL.
        # Example: GET /api/auth/login -> http://project-board-server-backend:5000/api/auth/login
        proxy_pass $API_BASE_URL;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_redirect off; # Do not rewrite Location headers

        # Optional: Add a timeout for the API backend to handle long-running requests if needed
        # proxy_connect_timeout 60s;
        # proxy_send_timeout 60s;
        # proxy_read_timeout 60s;
    }

    # Optional: Deny access to dotfiles for security
    location ~ /\. { # regex to match any hidden files (starting with a dot)
        deny all;
    }
}
